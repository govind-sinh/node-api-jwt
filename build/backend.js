!function(e){function n(r){if(t[r])return t[r].exports;var s=t[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}var t={};n.m=e,n.c=t,n.i=function(e){return e},n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p="",n(n.s=19)}([function(e,n){e.exports={secret:"ilovemyself",database:"mongodb://localhost/node-jwt"}},function(e,n){e.exports=require("express")},function(e,n){e.exports=require("jsonwebtoken")},function(e,n,t){"use strict";const r=t(9);var s=t(13);n.saveUser=function(e,n){var t=new r(e);return new s(function(e,n){t.save().then(function(n){e(n)},function(e){n(e)})})},n.getAllUsers=function(){return new s(function(e,n){r.find().then(function(n){e(n)},function(e){n(e)})})},n.getUserByName=function(e){return new s(function(n,t){r.findOne({name:e}).then(function(e){n(e)},function(e){t(e)})})}},function(e,n){e.exports=require("mongoose")},function(e,n,t){(function(n){var r=t(1),s=t(17),o=(t(18),t(16)),i=t(15),u=t(14),c=t(4),a=t(0),f=t(10),d=t(11),p=t(8),l=r();c.connect(a.database),l.set("views",s.join(n,"views")),l.set("view engine","jade"),l.set("superSecret",a.secret),l.use(o("dev")),l.use(u.json()),l.use(u.urlencoded({extended:!1})),l.use(i()),l.use(r.static(s.join(n,"public"))),l.use("/",f),l.use("/api",p.authorize,d),l.use(function(e,n,t){var r=new Error("Not Found");r.status=404,t(r)}),l.use(function(e,n,t,r){t.locals.message=e.message,t.locals.error="development"===n.app.get("env")?e:{},t.status(e.status||500),t.render("error")}),e.exports=l}).call(n,"/")},function(e,n){e.exports=require("debug")},function(e,n){e.exports=require("http")},function(e,n,t){var r=t(2),s=t(0);n.authorize=function(e,n,t){var o=e.body.token||e.query.token||e.headers["x-access-token"];if(!o)return n.status(403).send({success:!1,message:"No token provided."});r.verify(o,s.secret,function(r,s){if(r)return n.json({success:!1,message:"Failed to authenticate token."});e.decoded=s,t()})}},function(e,n,t){var r=t(4),s=t(12),o=r.Schema,i=new o({name:{type:String,required:!0},password:{type:String,required:!0},admin:{type:Boolean,required:!0}});i.pre("save",function(e){var n=this;if(!n.isModified("password"))return e();s.genSalt(5,function(t,r){if(t)return e(t);s.hash(n.password,r,null,function(t,r){if(t)return e(t);n.password=r,e()})})}),i.methods.verifyPassword=function(e,n){s.compare(e,this.password,function(e,t){if(e)return n(e);n(null,t)})},e.exports=r.model("User",i)},function(e,n,t){var r=t(1),s=r.Router(),o=t(3),i=t(2),u=t(0);s.get("/",function(e,n,t){n.render("index",{title:"Home"})}),s.post("/register",function(e,n){o.saveUser(e.body).then(function(e){n.send(e)},function(e){n.status(206).send(e)})}),s.post("/authenticate",function(e,n){o.getUserByName(e.body.name).then(function(t){t?t&&t.verifyPassword(e.body.password,function(e,r){if(e)return n.status(500).send(e);if(!r)return n.json({success:!1,message:"Authentication failed. Wrong password."});var s={sub:t._id,iss:"https://app-jwt.com",permissions:"identify"},o=i.sign(s,u.secret,{expiresIn:"24h",algorithm:"HS512"});n.json({success:!0,message:"Enjoy your token!",token:o})}):n.json({success:!1,message:"Authentication failed. User not found."})},function(e){n.status(500).send(e)})}),e.exports=s},function(e,n,t){var r=t(1),s=r.Router(),o=t(3);t(2),t(0);s.get("/",function(e,n,t){n.send("respond with a resource")}),s.get("/users",function(e,n){o.getAllUsers().then(function(e){n.send(e)},function(e){n.status(500).send(e)})}),e.exports=s},function(e,n){e.exports=require("bcrypt-nodejs")},function(e,n){e.exports=require("bluebird")},function(e,n){e.exports=require("body-parser")},function(e,n){e.exports=require("cookie-parser")},function(e,n){e.exports=require("morgan")},function(e,n){e.exports=require("path")},function(e,n){e.exports=require("serve-favicon")},function(e,n,t){function r(e){var n=parseInt(e,10);return isNaN(n)?e:n>=0&&n}function s(e){if("listen"!==e.syscall)throw e;var n="string"==typeof a?"Pipe "+a:"Port "+a;switch(e.code){case"EACCES":console.error(n+" requires elevated privileges"),process.exit(1);break;case"EADDRINUSE":console.error(n+" is already in use"),process.exit(1);break;default:throw e}}function o(){var e=f.address(),n="string"==typeof e?"pipe "+e:"port "+e.port;u("Listening on "+n),console.log("App has started on "+n)}var i=t(5),u=t(6)("node-api-jwt:server"),c=t(7),a=r(process.env.PORT||"3000");i.set("port",a);var f=c.createServer(i);f.listen(a),f.on("error",s),f.on("listening",o)}]);